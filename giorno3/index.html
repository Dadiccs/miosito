<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ASCII_ENGINE_COLOR // DF_OS</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>

<style>
  :root { --accent-color: #00ff64; --bg-dark: #010101; }
  body { margin: 0; overflow: hidden; background: var(--bg-dark); font-family: 'Courier New', monospace; color: var(--accent-color); }
  
  body::after {
    content: " "; display: block; position: absolute; inset: 0;
    background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%);
    z-index: 150; background-size: 100% 4px; pointer-events: none;
  }

  .control-deck {
    position: absolute; top: 20px; left: 20px; width: 280px;
    background: rgba(0,0,0,0.94); border: 1px solid var(--accent-color);
    box-shadow: 0 0 30px rgba(0,255,100,0.15); z-index: 100; backdrop-filter: blur(10px);
    max-height: 95vh; overflow-y: auto;
  }

  .panel-header { background: var(--accent-color); color: #000; padding: 10px 15px; font-size: 11px; font-weight: bold; letter-spacing: 2px; }
  .panel-content { padding: 15px; }
  h3 { font-size: 9px; margin: 0 0 10px 0; opacity: 0.6; letter-spacing: 1px; }
  .section { margin-bottom: 20px; border-bottom: 1px solid rgba(0,255,100,0.1); padding-bottom: 15px; }

  .text-input, .ui-select {
    width: 100%; background: #000; border: 1px solid rgba(0, 255, 100, 0.4);
    color: var(--accent-color); padding: 10px; font-family: inherit; font-size: 13px;
    outline: none; text-transform: uppercase; box-sizing: border-box;
  }

  .ui-btn {
    background: transparent; color: var(--accent-color); border: 1px solid rgba(0,255,100,0.2);
    padding: 10px; cursor: pointer; font-family: inherit; font-size: 10px; width: 100%;
    text-align: left; transition: 0.2s; text-transform: uppercase; margin-bottom: 4px;
  }
  .ui-btn:hover { background: rgba(0, 255, 100, 0.1); }
  .ui-btn.active { background: var(--accent-color); color: #000; font-weight: bold; }

  /* PALETTE COLORI */
  .palette-grid { display: flex; gap: 8px; margin-top: 10px; }
  .color-chip {
    width: 30px; height: 30px; border: 1px solid rgba(255,255,255,0.2);
    cursor: pointer; transition: transform 0.2s;
  }
  .color-chip:hover { transform: scale(1.1); border-color: #fff; }
  .color-chip.active { border: 2px solid #fff; outline: 1px solid var(--bg-dark); }

  .ui-slider { -webkit-appearance: none; appearance: none; width: 100%; height: 1px; background: var(--accent-color); outline: none; margin: 15px 0; }
  .ui-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 10px; height: 18px; background: #fff; cursor: pointer; border: 1px solid var(--accent-color); }

  .shortcut-hint { font-size: 9px; color: #fff; opacity: 0.8; margin-top: 10px; display: block; border: 1px solid rgba(255,255,255,0.2); padding: 8px; text-align: center; }
  #fileInput { display: none; }
</style>
</head>
<body>

<div class="control-deck">
  <div class="panel-header">ASCII_OS_ULTRA_v4.5</div>
  <div class="panel-content">
    
    <div class="section">
      <h3>> DATA_SOURCE</h3>
      <input type="text" id="userInput" class="text-input" value="Dadiccs" maxlength="12" oninput="isImageMode=false; initParticles();">
      <button class="ui-btn" onclick="document.getElementById('fileInput').click()" style="margin-top:10px; border-style:dashed; text-align:center;">[+] UPLOAD_IMAGE</button>
      <input type="file" id="fileInput" accept="image/*">
    </div>

    <div class="section">
      <h3>> COLOR_PROFILE</h3>
      <div class="palette-grid">
        <div class="color-chip active" style="background: #00ff64;" onclick="changeTheme('#00ff64', this)"></div>
        <div class="color-chip" style="background: #ffb400;" onclick="changeTheme('#ffb400', this)"></div>
        <div class="color-chip" style="background: #ff00ff;" onclick="changeTheme('#ff00ff', this)"></div>
        <div class="color-chip" style="background: #00e5ff;" onclick="changeTheme('#00e5ff', this)"></div>
        <div class="color-chip" style="background: #ffffff;" onclick="changeTheme('#ffffff', this)"></div>
      </div>
    </div>

    <div class="section">
      <h3>> BEHAVIOR_LOGIC</h3>
      <button class="ui-btn active" onclick="setMode('thickness', this)">Deep_Density [INV]</button>
      <button class="ui-btn" onclick="setMode('magneto', this)">Hyper_Lens [Spherize]</button>
      <button class="ui-btn" onclick="setMode('vortex', this)">Vortex_Warp [Spiral]</button>
      <button class="ui-btn" onclick="setMode('bomb', this)">FRAG_BOMB [!]</button>
    </div>

    <div class="section">
      <h3>> SCAN_PARAMS</h3>
      <div id="density-slider-anchor"></div>
      <select id="charSetSelect" class="ui-select" onchange="updateCharSet(); initParticles();" style="margin-top:10px;">
        <option value="minimal">SET: MINIMAL (Dots)</option>
        <option value="standard">SET: STANDARD</option>
        <option value="terminal">SET: TERMINAL</option>
      </select>
    </div>

    <div class="section">
      <div class="shortcut-hint">⌨ [ SHIFT + S ] EXPORT PNG<br>[ CLICK ] DETONATE BOMB</div>
    </div>

    <a href="https://dadiccs.github.io/miosito/" class="home-btn" style="display:block; text-align:center; text-decoration:none; color:var(--accent-color); font-size:10px; border:1px dashed var(--accent-color); padding:10px;">[X] EXIT_SESSION</a>
  </div>
</div>

<script>
  let currentMode = 'thickness';
  let imgSource = null;
  let isImageMode = false;
  let particles = [];
  let bombs = [];
  let densitySlider;
  let themeColor = '#00ff64';
  
  const sets = {
    minimal: ["•", "·", "°", ".", " ", " "],
    standard: ["@", "#", "W", "$", "m", "w", "*", "+", "=", ":", "-", ".", " "],
    terminal: ["█", "▓", "▒", "░", "#", "≡", " "]
  };

  let currentChars = sets.minimal;

  function setup() {
    createCanvas(windowWidth, windowHeight);
    pixelDensity(1);
    densitySlider = createSlider(6, 28, 12, 1).addClass('ui-slider').parent('density-slider-anchor');
    densitySlider.input(initParticles);
    document.getElementById('fileInput').addEventListener('change', handleFile);
    initParticles();
  }

  function changeTheme(hex, el) {
    themeColor = hex;
    document.documentElement.style.setProperty('--accent-color', hex);
    document.querySelectorAll('.color-chip').forEach(c => c.classList.remove('active'));
    el.classList.add('active');
    if(!isImageMode) initParticles();
  }

  function handleFile(e) {
    let file = e.target.files[0];
    if (file) {
      let reader = new FileReader();
      reader.onload = (event) => {
        imgSource = loadImage(event.target.result, () => {
          isImageMode = true;
          initParticles();
        });
      };
      reader.readAsDataURL(file);
    }
  }

  function initParticles() {
    particles = [];
    let step = densitySlider.value();
    let pg = createGraphics(width, height);
    
    if (isImageMode && imgSource) {
      let imgW = width, imgH = (imgSource.height / imgSource.width) * width;
      if (imgH > height) { imgH = height; imgW = (imgSource.width / imgSource.height) * height; }
      pg.imageMode(CENTER);
      pg.image(imgSource, width/2, height/2, imgW, imgH);
      pg.loadPixels();
    } else {
      let userText = document.getElementById('userInput').value || " ";
      pg.background(0); pg.fill(255); pg.textAlign(CENTER, CENTER);
      pg.textSize(min(width / (userText.length * 0.7), height * 0.6));
      pg.text(userText, width/2, height/2);
      pg.loadPixels();
    }

    for (let y = 0; y < height; y += step) {
      for (let x = 0; x < width; x += step) {
        let i = (x + y * width) * 4;
        let r = pg.pixels[i], g = pg.pixels[i+1], b = pg.pixels[i+2];
        let bright = (r + g + b) / 3;
        if (bright > 15) {
          let col = isImageMode ? color(r, g, b) : color(themeColor);
          particles.push(new Particle(x, y, bright, col));
        }
      }
    }
  }

  class Particle {
    constructor(x, y, bright, col) {
      this.origX = x; this.origY = y;
      this.x = x; this.y = y;
      this.vx = 0; this.vy = 0;
      this.angle = 0; this.va = 0;
      this.bright = bright;
      this.baseCol = col;
      this.active = false;
    }

    update() {
      if (this.active) {
        this.x += this.vx; this.y += this.vy; this.angle += this.va;
        this.vx *= 0.96; this.vy *= 0.96;
        if (abs(this.vx) < 0.15) {
          this.x = lerp(this.x, this.origX, 0.05);
          this.y = lerp(this.y, this.origY, 0.05);
          this.angle = lerp(this.angle, 0, 0.05);
          if (dist(this.x, this.y, this.origX, this.origY) < 1) this.active = false;
        }
      }
    }
  }

  function draw() {
    background(0, 10, 0);
    let step = densitySlider.value();

    for (let i = bombs.length - 1; i >= 0; i--) {
      let b = bombs[i];
      if (!b.exploded) {
        b.timer--;
        noFill(); stroke(255, 0, 0); ellipse(b.x, b.y, (30-b.timer)*3);
        if (b.timer <= 0) {
          b.exploded = true; b.radius = 200;
          particles.forEach(p => {
            let d = dist(b.x, b.y, p.x, p.y);
            if (d < 200) {
              let ang = atan2(p.y - b.y, p.x - b.x);
              p.vx = cos(ang) * map(d, 0, 200, 25, 5);
              p.vy = sin(ang) * map(d, 0, 200, 25, 5);
              p.va = random(-0.3, 0.3); p.active = true;
            }
          });
        }
      } else {
        b.radius += 15; stroke(255, map(b.radius, 200, 600, 255, 0));
        ellipse(b.x, b.y, b.radius);
        if (b.radius > 600) bombs.splice(i, 1);
      }
    }

    particles.forEach(p => {
      p.update();
      let dX = p.x, dY = p.y, curSize = step;
      let d = dist(mouseX, mouseY, p.x, p.y);
      let influence = map(d, 0, 350, 1, 0, true);
      
      let charIdx;
      let charCol = isImageMode ? p.baseCol : color(themeColor);
      let charRot = p.angle;

      if (!p.active) {
        if (currentMode === 'thickness') {
          let baseIdx = floor(map(p.bright, 0, 255, currentChars.length - 1, 0));
          charIdx = floor(lerp(currentChars.length - 1, baseIdx, influence));
          curSize *= (1 + influence * 1.5);
          let dimCol = color(red(charCol), green(charCol), blue(charCol), 80);
          charCol = lerpColor(dimCol, color(255), influence);
        } else if (currentMode === 'magneto') {
          charIdx = floor(map(p.bright, 0, 255, currentChars.length - 1, 0));
          let push = sin(influence * PI) * 60; 
          dX += cos(atan2(p.y - mouseY, p.x - mouseX)) * push;
          dY += sin(atan2(p.y - mouseY, p.x - mouseX)) * push;
          curSize *= (1 + influence * 2.5);
        } else if (currentMode === 'vortex') {
          charIdx = floor(map(p.bright, 0, 255, currentChars.length - 1, 0));
          let ang = atan2(p.y - mouseY, p.x - mouseX);
          let twist = influence * PI * 2.5; 
          dX += cos(ang + twist) * (influence * 150);
          dY += sin(ang + twist) * (influence * 150);
          charRot += twist;
        } else {
          charIdx = floor(map(p.bright, 0, 255, currentChars.length - 1, 0));
        }
      } else {
        charIdx = 0; charCol = color(255);
      }

      fill(charCol);
      textSize(curSize);
      push(); translate(dX, dY); rotate(charRot);
      text(currentChars[charIdx], 0, 0);
      pop();
    });
  }

  function mousePressed() { if (currentMode === 'bomb' && mouseX > 300) bombs.push({ x: mouseX, y: mouseY, timer: 30, exploded: false, radius: 0 }); }
  function updateCharSet() { currentChars = sets[document.getElementById('charSetSelect').value]; }
  function setMode(mode, btn) { currentMode = mode; document.querySelectorAll('.ui-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
  function keyPressed() { if (keyIsDown(SHIFT) && (keyCode === 83)) saveCanvas('ASCII_ART', 'png'); }
  function windowResized() { resizeCanvas(windowWidth, windowHeight); initParticles(); }
</script>
</body>
</html>